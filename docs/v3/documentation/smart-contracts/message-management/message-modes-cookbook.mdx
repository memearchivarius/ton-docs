# Message Modes Cookbook

Understanding the different modes and flags available for sending messages is important to ensure that your smart contracts behave correctly. 
While [Message-modes](/v3/documentation/smart-contracts/message-management/sending-messages#message-modes) section provided detailed descriptions of these modes and flags, in this section we will illustrate their practical application with concrete examples.

#### Message value and account balance
There are 2 ways to pay for blockchain action: from [contract balance](https://github.com/ton-blockchain/ton/blob/7151ff26279fef6dcfa1f47fc0c5b63677ae2458/crypto/block/block.tlb#L263C1-L265C20) and from [message value](/v3/documentation/data-formats/tlb/msg-tlb#commonmsginfo). Typically it's charged from contract balance but in specific cases it will use part of message value.

:::info IMPORTANT
__Note__: The transaction fees used in these examples are hypothetical and are used for illustrative purposes only, any fees other than message forward are out of scope of this article. Actual transaction fees will vary depending on network conditions and other factors. When message is received, part of it will be consumed for gas and storage fees. You can check [this example](https://testnet.tonviewer.com/transaction/42ed45726e4fe994b7fd6dbf953a2ac24ecd77753858abeda9d6755c664a537a) as a real-world confirmation.
:::

## 1. Send a regular message

State before tx: Account A has 1 TON, Account B has 1 TON

You sent 0,1 TON, [msg_fwd_fees](/v3/documentation/smart-contracts/transaction-fees/fees-low-level#forward-fees) are 0.004 TON, actual received value will be 0.096 TON, `fwd_fee` and `action_fee` deducted from `value`.

State after tx: Account A has 0.9 TON, Account B has 1.096 TON

![](/img/docs/message-modes-cookbook/send_regular_message.svg)

| Mode and Flags | Code |
|:-|:-|
| `mode` = 0, no `flag` | `send_raw_message(msg, 0)` |

## 2. Send a regular message, no bounce the message on error and ignore it

State before tx: Account A has 1 TON, Account B has 1 TON

The result is the same as [mode = 0](## 1. Send a regular message)
In case of an error during transaction processing, the message will not bounce and will be ignored.

State after tx: Account A has 0.9 TON, Account B has 1.096 TON

:::info tip
Funds included with an ignored message will still be [credited to the receiving address](https://testnet.tonviewer.com/transaction/8a388731812c80ab9b0ea9531108425488af5def854e4bd6f0ed47362b56d557)
:::

![](/img/docs/message-modes-cookbook/send_regular_message_and_ignore_errors.svg)

| Mode and Flags | Code |
|:-|:-|
| `mode` = 0, `flag` = 2 | `send_raw_message(msg, 2)` |

## 3. Send a regular message and bounce the message on error

Fwd_fee and action_fee will be deducted from message.
You sent 1 TON, fee is 0.04 TON, actual received value will be 0.96 TON.
If an [error occurs during action processing](https://retracer.ton.org/?tx=e9dccba82badc0d742f14eff41c203280f380e87180b5314fcfd742856e598f7&testnet=true) - bounce the message.
Then total fee + fwd_fee will be deducted and bounced value will be 1 - `total_fee` TON.

![](/img/docs/message-modes-cookbook/send_regular_message_and_bounce_if_error.svg)

| Mode and Flags | Code |
|:-|:-|
| `mode` = 0, `flag` = 16 | `send_raw_message(msg, 16)` |

## 4. Send a regular message with separate fees

Fwd_fee and action_fee will be deducted from contract balance.
You sent 1 TON, fee is 0.04 TON, actual received value will be 1 TON.

![](/img/docs/message-modes-cookbook/send_regular_and_pay_fees_separately.svg)

| Mode and Flags | Code |
|:-|:-|
| `mode` = 0, `flag` = 1 | `send_raw_message(msg, 1)` |

## 5. Send a regular message with separate fees and bounce the message on error

Fwd_fee and action_fee will be deducted from contract balance.
You sent 1 TON, fee is 0.04 TON, actual received value will be 1 TON.
if an error occurs during action processing - bounce the message.
Then total fee + fwd_fee will be deducted and bounced value will be 1 - `total_fee` TON.

![](/img/docs/message-modes-cookbook/send_regular_message_pay_fee_separately_bounce_if_error.svg)

| Mode and Flags | Code |
|:-|:-|
| `mode` = 0, `flag` = 1 + 16 = 17 | `send_raw_message(msg, 17)` |

## 6. Carry remaining value with new message

Fwd_fee and action_fee will be deducted from message.
You received X TON, then sent 1 TON, fee is 0.04 TON, actual received value will be X + 0.96 TON.

![](/img/docs/message-modes-cookbook/carry_all_the_remaining_value.svg)

| Mode and Flags | Code |
|:-|:-|
| `mode` = 64, no `flag` | `send_raw_message(msg, 64)` |

## 7. Carry remaining value with new message with separate fees

Fwd_fee and action_fee will be deducted from contract.
You received X TON, then sent 1 TON, fee is 0.04 TON, actual received value will be X + 1 TON.

![](/img/docs/message-modes-cookbook/carry_all_the_remaining_value_and_pay_fees_separately.svg)

| Mode and Flags | Code |
|:-|:-|
| `mode` = 64, `flag` = 1 | `send_raw_message(msg, 65)` |

## 8. Carry remaining value and bounce the message on error

Fwd_fee and action_fee will be deducted from message.
You received X TON, then sent 1 TON, fee is 0.04 TON, actual received value will be X + 0.96 TON.
If an error occurs during action processing - bounce the message.
Then total fee + fwd_fee will be deducted from in_msg and bounced value will be X - `total_fee` TON.

![](/img/docs/message-modes-cookbook/carry_all_the_remaining_value_and_if_error_bounce.svg)

| Mode and Flags | Code |
|:-|:-|
| `mode` = 64, `flag` = 16 | `send_raw_message(msg, 80)` |

## 9. Carry remaining value with new message with separate fees and bounce the message on error

Fwd_fee and action_fee will be deducted from contract.
You received X TON, then sent 1 TON, fee is 0.04 TON, actual received value will be X + 1 TON.
If an error occurs during action processing - bounce the message.
Then total fee + fwd_fee will be deducted from in_msg and bounced value will be X - `total_fee` TON.

![](/img/docs/message-modes-cookbook/carry_all_the_remaining_value_and_pay_fees_separately_and_if_error_bounce.svg)

| Mode and Flags | Code |
|:-|:-|
| `mode` = 64, `flag` = 16 + 1 | `send_raw_message(msg, 81)` |

## 10. Send all received tokens together with the contract balance

Fwd_fee and action_fee will be deducted from message.
We currently have 100 Toncoin in the balance of our smart contract.
After receiving an internal message with X TON we send a message, fee is 0.04 TON, actual received value will be X + 100 - 0.04 TON.

![](/img/docs/message-modes-cookbook/send_all_received_tokens_with_balance.svg)

| Mode and Flags | Code |
|:-|:-|
| `mode` = 128, no `flag` | `send_raw_message(msg, 128)` |

## 11. Send all received tokens together with the contract balance and bounce the message on error

Fwd_fee and action_fee will be deducted from message.
We currently have 100 Toncoin in the balance of our smart contract.
After receiving an internal message with X TON we send a message, fee is 0.04 TON, actual received value will be X + 100 - 0.04 TON.
If an error occurs during action processing - bounce the message.
Then total fee + fwd_fee will be deducted from in_msg and bounced value will be X - `total_fee` TON.

![](/img/docs/message-modes-cookbook/send_all_received_tokens_with_balance_and_if_error_bounce.svg)

| Mode and Flags | Code |
|:-|:-|
| `mode` = 128, `flag` = 16 | `send_raw_message(msg, 144)` |

## 12. Send all received tokens together with the contract balance and destroy smart-contract

Fwd_fee and action_fee will be deducted from message.
We currently have 100 Toncoin in the balance of our smart contract.
After receiving an internal message with X TON we send a message, fee is 0.04 TON, actual received value will be X + 100 - 0.04 TON.
When the balance reaches 0 TON destroy the contract.

![](/img/docs/message-modes-cookbook/send_all_received_tokens_with_balance_and_destroy_sc.svg)

| Mode and Flags | Code |
|:-|:-|
| `mode` = 128, `flag` = 32 | `send_raw_message(msg, 160)` |
